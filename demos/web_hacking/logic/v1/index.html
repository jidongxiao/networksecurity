<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Online Shop Demo — Cart v1</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      max-width:700px;
      margin:2rem auto;
      background:#f5f5f5;
      color:#333;
    }
    h1, h2 { color:#444; }
    .product, .cart-item {
      display:flex;
      gap:1rem;
      align-items:center;
      padding:0.5rem 0;
      border-bottom:1px solid #ddd;
    }
    .product:last-child, .cart-item:last-child { border-bottom:none; }
    input[type="number"] { width:4rem; padding:0.2rem; }
    button {
      padding:0.4rem 0.8rem;
      border:none;
      border-radius:4px;
      background:#007bff;
      color:white;
      cursor:pointer;
      transition: background 0.2s;
    }
    button:hover { background:#0056b3; }
    .remove-btn {
      background:#dc3545;
    }
    .remove-btn:hover {
      background:#a71d2a;
    }
    #cart { 
      border:1px solid #ddd;
      padding:0.5rem;
      border-radius:6px;
      margin-top:1rem;
      background:white;
    }
    #result { 
      margin-top:1rem;
      padding:0.8rem;
      border-radius:6px;
      background:white;
      box-shadow:0 2px 5px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <h1>Welcome, Bob!</h1>
  <p>Your balance: $<span id="balance">100.00</span></p>

  <h2>Products</h2>
  <div class="product">
    <div style="flex:1;"><strong>Laptop</strong> — $5000.00 each</div>
    <label>Qty <input id="qty-laptop" type="number" value="1" min="1" /></label>
    <button onclick="addToCart('laptop','Laptop',5000)">Add to cart</button>
  </div>

  <div class="product">
    <div style="flex:1;"><strong>Pencil</strong> — $1.00 each</div>
    <label>Qty <input id="qty-pencil" type="number" value="1" min="1" /></label>
    <button onclick="addToCart('pencil','Pencil',1)">Add to cart</button>
  </div>

  <h2>Shopping Cart</h2>
  <div id="cart">Cart is empty</div>
  <button onclick="checkout()">Checkout</button>

  <div id="result">—</div>

<script>
let cart = []; // per browser/tab

function renderCart() {
  const container = document.getElementById('cart');
  if (cart.length === 0) {
    container.innerText = 'Cart is empty';
  } else {
    container.innerHTML = '';
    cart.forEach((item, index) => {
      const div = document.createElement('div');
      div.className = 'cart-item';
      div.innerHTML = `
        <span>${item.quantity} × ${item.itemName} — $${item.price.toFixed(2)}</span>
        <button class="remove-btn" onclick="removeFromCart(${index})">Remove</button>
      `;
      container.appendChild(div);
    });
  }
}

function addToCart(productId, itemName, unitPrice) {
  const qtyInput = document.getElementById('qty-' + productId);
  const qty = Math.max(1, parseInt(qtyInput.value, 10) || 1);
  const price = Number((unitPrice * qty).toFixed(2)); // client computes price

  cart.push({ productId, itemName, quantity: qty, price });
  renderCart();
}

function removeFromCart(index) {
  cart.splice(index, 1);
  renderCart();
}

function generateOrderId() {
  return Math.random().toString(36).substr(2, 9).toUpperCase();
}

async function checkout() {
  if (cart.length === 0) {
    alert("Your cart is empty!");
    return;
  }

  const r = await fetch('/checkout', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ cart }) // send entire cart to server (price + quantity)
  });
  const data = await r.json();

  if (data.success) {
    // Professional-style confirmation message
    let msg = `<h3>Thank you for your order, Bob!</h3>`;
    msg += `<p>Your transaction has been processed successfully.</p>`;
    msg += `<h4>Order details:</h4><ul>`;
    cart.forEach(item => {
      msg += `<li>${item.quantity} × ${item.itemName} — $${item.price.toFixed(2)}</li>`;
    });
    msg += `</ul>`;
    const total = cart.reduce((sum, item) => sum + item.price, 0);
    msg += `<p><strong>Total charged: $${total.toFixed(2)}</strong></p>`;
    msg += `<p>Remaining balance: $${Number(data.balance).toFixed(2)}</p>`;
    msg += `<p>Order ID: <em>${generateOrderId()}</em></p>`;

    document.getElementById('result').innerHTML = msg;

    cart = []; // clear client cart
    renderCart();
    document.getElementById('balance').innerText = Number(data.balance).toFixed(2);
  } else {
    document.getElementById('result').innerHTML = `<p style="color:red;">${data.message}</p>`;
  }
}
</script>

</body>
</html>
